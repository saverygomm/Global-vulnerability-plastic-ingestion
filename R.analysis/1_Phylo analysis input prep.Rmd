---
title: "1_Phylo analysis input prep"
author: "Stephanie Avery-Gomm"
date: "1/21/2017"
output: html_document
editor_options: 
chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
root.dir = dirname(getwd()) # this might work better for PC users.
knitr::opts_knit$set(root.dir = root.dir)
```


```{r initialize, include=FALSE}

# Initializing
    # Clear workspace
    rm(list=ls())
    gc()
    
    # Confirm Working Directory is correct
    getwd()
    

# load libraries
    
library(tidyverse) # used for data wrangling 

# set seed for reproducability
set.seed(1)

sessionInfo()

`%notin%` <- Negate(`%in%`) # Add this function!


```

# Merge trait & plastic data

# The trait dataset (Data S1) includes data from numerous sources. See Data S7 for full metadata. 
        # BirdLife Version 9, SISRecID and BirdTree nomenclatures are provided, but BirdTree is dominant (even though it causes some lumps - and mis-nomers compared to BirdLife) because it's used in this phylogenetic analysis. http://datazone.birdlife.org/userfiles/file/Species/Taxonomy/BirdLife_Checklist_Version_90.zip. 
        # Body.Mass.g & Source provided for species with plastic data from Handbook of Birds of the World or CRC Handbook of Avian Body Masses, Second Edition. CRC Press (2007).
        # Diet and feeding method information mostly from Del Hoyo J, Elliot A, Sargatal J, Christie DA, de Juana E. 2018 Handbook of the Birds of the World. Barcelona: Lynx Editions. See https://www.hbw.com (accessed on 15 February 2018). See "link_species"
        # DMS.Responsive.Savoca, DMS.responsive.Dell.Ariccia, Agreement_Savoca_Dell.Aricca. The Savoca dataset was downloaded from Savova et al. 2016 who did most of the heavy lifting re collating species data. Dell'Ariccia provides some quality control, and should be the data used.  I have changed the species-names for a couple of seabirds that didn't line up, and added data for 4 penguin species. All original references are available in DMS_sensitivity_database.xlsx. I also added a field comparing the two datasets so that differences are clear.
                # Savoca, M.S., Wohlfeil, M.E., Ebeler, S.E., Nevitt, G.A., 2016. Marine plastic debris emits a keystone infochemical for olfactory foraging seabirds. Science Advances 2, e1600395. https://doi.org/10.1126/sciadv.1600395
                # Dell’Ariccia, G., Phillips, R. A., van Franeker, J. A., Gaidet, N., Catry, P., Granadeiro, J. P., … Bonadonna, F. (2017). Comment on “Marine plastic debris emits a keystone infochemical for olfactory foraging seabirds” by Savoca et al. Science Advances, 3(6), e1700526. https://doi.org/10.1126/sciadv.1700526
        # Other data from BirdLife http://datazone.birdlife.org/userfiles/file/Species/Taxonomy/BirdLife_Checklist_Version_90.zip. 

```{r merge.Data1and2}

# Load supplementary data
    DataS1 <-read.csv("./supplementary material/Data S1. Behavioural and life-history dataset includes available information on all 351 seabird species that are recognized by both BirdLife and the Tree of Life.csv", strip.white = T, stringsAsFactors = T)
    DataS2 <-read.csv("./supplementary material/Data S2. Plastic ingestion records for ~50,000 individual birds representing 212 of 351 seabird species.csv", strip.white = T, stringsAsFactors = T)
    
    colnames(DataS1)
    colnames(DataS2)
    
    DataS1<-dplyr::select(DataS1, SISRecID_BLVr9, Link_species:Agreement_Savoca_Dell.Ariccia)
    
    data2<-left_join(DataS2, DataS1, by = "SISRecID_BLVr9")
    
    str(data2)

# Prepare dataset for main analysis

  # Recode individual prey types to Yes/No so they aren't mistaken for count
    
    data2$Carrion.NonFishVertebrates[data2$Carrion.NonFishVertebrates == 0] <- "No"
    data2$Carrion.NonFishVertebrates[data2$Carrion.NonFishVertebrates == 1] <- "Yes"
    data2$Carrion.NonFishVertebrates <- as.factor(data2$Carrion.NonFishVertebrates)
    levels(data2$Carrion.NonFishVertebrates)
    
    data2$Cephalopods[data2$Cephalopods == 0] <- "No"
    data2$Cephalopods[data2$Cephalopods == 1] <- "Yes"
    data2$Cephalopods <- as.factor(data2$Cephalopods)
    levels(data2$Cephalopods)
    
    data2$Crustaceans[data2$Crustaceans == 0] <- "No"
    data2$Crustaceans[data2$Crustaceans == 1] <- "Yes"
    data2$Crustaceans <- as.factor(data2$Crustaceans)
    levels(data2$Crustaceans)
    
    data2$Fish[data2$Fish == 0] <- "No"
    data2$Fish[data2$Fish == 1] <- "Yes"
    data2$Fish <- as.factor(data2$Fish)
    levels(data2$Fish)
    
    data2$Other.Inverts[data2$Other.Inverts == 0] <- "No"
    data2$Other.Inverts[data2$Other.Inverts == 1] <- "Yes"
    data2$Other.Inverts <- as.factor(data2$Other.Inverts)
    levels(data2$Other.Inverts)
    
    
    unique(data2$Diet)
    data2$Diet[data2$Diet == "Unknown"] <- NA
    data2 <- data2 %>%
      droplevels()
    unique(data2$Diet)

    # Confirm correct dimensions
    dim(data2) # 1528 43

# save as intermediate output file, necessary for next two scripts.  
write.csv(data2, "./output/data2.csv", row.names = F)

```


### End ####









