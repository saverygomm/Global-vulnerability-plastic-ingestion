# https://stackoverflow.com/questions/4090169/elegant-way-to-check-for-missing-packages-and-install-them


# A lot of the answers above (and on duplicates of this question) rely on installed.packages which is bad form. From the documentation:
#     
        # This can be slow when thousands of packages are installed, so do not use this to find out if a named package is installed (use system.file or find.package) nor to find out if a package is usable (call require and check the return value) nor to find details of a small number of packages (use packageDescription). It needs to read several files per installed package, which will be slow on Windows and on some network-mounted file systems.


# So, a better approach is to attempt to load the package using require and and install if loading fails (require will return FALSE if it isn't found). I prefer this implementation:
    #                                                                               
    # using<-function(...) {
    # libs<-unlist(list(...))
    # req<-unlist(lapply(libs,require,character.only=TRUE))
    # need<-libs[req==FALSE]
    # if(length(need)>0){
    # install.packages(need)
    # lapply(need,require,character.only=TRUE)
    # }
    # }

# which can be used like this:

# using("caper","car","phylolm", "lmtest","phytools", "boot","lme4","gtools","ape","MCMCglmm","MuMIn","tidyverse","beepr")

# This way it loads all the packages, then goes back and installs all the missing packages (which if you want, is a handy place to insert a prompt to ask if the user wants to install packages). Instead of calling install.packages separately for each package it passes the whole vector of uninstalled packages just once.
#                                                                                                         
# Here's the same function but with a windows dialog that asks if the user wants to install the missing packages
                                                                                       
    using<-function(...) {
        libs<-unlist(list(...))
        req<-unlist(lapply(libs,require,character.only=TRUE))
        need<-libs[req==FALSE]
        n<-length(need)
        if(n>0){
            libsmsg<-if(n>2) paste(paste(need[1:(n-1)],collapse=", "),",",sep="") else need[1]
        print(libsmsg)
        if(n>1){
            libsmsg<-paste(libsmsg," and ", need[n],sep="")
        }
        libsmsg<-paste("The following packages could not be found: ",libsmsg,"\n\r\n\rInstall missing packages?",collapse="")
        if(winDialog(type = c("yesno"), libsmsg)=="YES"){       
            install.packages(need)
            lapply(need,require,character.only=TRUE)
        }
    }
    }